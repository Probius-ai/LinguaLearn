<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" th:data-theme="${session.theme != null ? session.theme : 'light'}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í∑∏Î¶º Îã®Ïñ¥ ÌÄ¥Ï¶à - LinguaLearn</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/image-quiz.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script th:src="@{/js/theme-switcher.js}" defer></script>
    <link rel="stylesheet" th:href="@{/css/session-timeout.css}">
    <script th:src="@{/js/session-manager.js}" defer></script>
</head>
<body>
    <!-- Ìó§Îçî ÏòÅÏó≠ -->
    <header class="header">
        <div class="container header-container">
            <div class="logo">
                <h1><a th:href="@{/}"><i class="fas fa-language"></i> LinguaLearn</a></h1>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a th:href="@{/}">Ìôà</a></li>
                    <li><a th:href="@{/quiz}" class="active">Îã®Ïñ¥ ÌÄ¥Ï¶à</a></li>
                    <li><a th:href="@{/translate}">Î≤àÏó≠ ÎèÑÍµ¨</a></li>
                    <li><a th:href="@{/words}">Ï∂îÏ≤ú Îã®Ïñ¥</a></li>
                </ul>
            </nav>
            <div class="user-actions">
                <div class="theme-switcher">
                    <button id="theme-toggle" aria-label="ÌÖåÎßà Î≥ÄÍ≤Ω">
                        <i class="fas fa-sun light-icon"></i>
                        <i class="fas fa-moon dark-icon"></i>
                    </button>
                    <div class="theme-dropdown">
                        <button data-theme="light">Light</button>
                        <button data-theme="dark">Dark</button>
                        <button data-theme="blue">Blue</button>
                        <button data-theme="green">Green</button>
                    </div>
                </div>
                
                <!-- Î°úÍ∑∏Ïù∏ Î≤ÑÌäº (ÏÑ∏ÏÖòÏóê ÏÇ¨Ïö©ÏûêÍ∞Ä ÏóÜÏùÑ ÎïåÎßå ÌëúÏãú) -->
                <button th:if="${session.user == null}" class="btn login-btn" id="login-btn">Î°úÍ∑∏Ïù∏</button>

                <!-- Î°úÍ∑∏Ïù∏Ìïú ÏÉÅÌÉúÏùº Îïå ÌîÑÎ°úÌïÑ ÎßÅÌÅ¨ÏôÄ Î°úÍ∑∏ÏïÑÏõÉ Î≤ÑÌäº ÌëúÏãú -->
                <div th:if="${session.user != null}" class="user-logged-in">
                    <a href="/profile" class="profile-link" title="ÌîÑÎ°úÌïÑ Î≥¥Í∏∞">
                        <div class="avatar" th:text="${#strings.substring(session.user.displayName, 0, 1)}">U</div>
                    </a>
                    <button class="btn logout-btn" id="logout-btn">Î°úÍ∑∏ÏïÑÏõÉ</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
    <main>
        <div class="container">
            <div class="quiz-container">
                <h1 class="section-title">üñºÔ∏è Í∑∏Î¶º Îã®Ïñ¥ ÌÄ¥Ï¶à</h1>

                <!-- Ïñ∏Ïñ¥ ÏÑ†ÌÉù ÏòÅÏó≠ -->
                <div id="language-select" class="selection-area">
                    <h2>Ïñ∏Ïñ¥Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h2>
                    <div class="language-buttons">
                        <button class="btn btn-language" onclick="selectLanguage('english')">
                            <i class="fas fa-flag-usa"></i> ÏòÅÏñ¥
                        </button>
                        <button class="btn btn-language" onclick="selectLanguage('japanese')">
                            <i class="fas fa-torii-gate"></i> ÏùºÎ≥∏Ïñ¥
                        </button>
                        <button class="btn btn-language" onclick="selectLanguage('chinese')">
                            <i class="fas fa-yen-sign"></i> Ï§ëÍµ≠Ïñ¥
                        </button>
                    </div>
                </div>

                <!-- ÎÇúÏù¥ÎèÑ ÏÑ†ÌÉù ÏòÅÏó≠ -->
                <div id="level-select" class="selection-area" style="display:none;">
                    <h2>ÎÇúÏù¥ÎèÑÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h2>
                    <div class="level-buttons">
                        <button class="btn btn-level" onclick="startQuiz('beginner')">
                            <i class="fas fa-seedling"></i> Ï¥àÍ∏â
                        </button>
                        <button class="btn btn-level" onclick="startQuiz('intermediate')">
                            <i class="fas fa-tree"></i> Ï§ëÍ∏â
                        </button>
                        <button class="btn btn-level" onclick="startQuiz('advanced')">
                            <i class="fas fa-crown"></i> Í≥†Í∏â
                        </button>
                    </div>
                    <button class="btn btn-back" onclick="goBack()">
                        <i class="fas fa-arrow-left"></i> Îí§Î°úÍ∞ÄÍ∏∞
                    </button>
                </div>

                <!-- ÌÄ¥Ï¶à ÏòÅÏó≠ -->
                <div id="quiz-section" class="quiz-area" style="display:none;">
                    <div class="quiz-status">
                        <span id="quiz-counter">Î¨∏Ï†ú 1/10</span>
                        <span id="quiz-score">Ï†êÏàò: 0</span>
                    </div>
                    
                    <div class="image-box">
                        <img id="quiz-image" src="" alt="ÌÄ¥Ï¶à Ïù¥ÎØ∏ÏßÄ" />
                    </div>
                    
                    <div class="options" id="options-box"></div>
                    
                    <div class="result-area">
                        <p id="result"></p>
                        <div id="score-update" style="display:none;">
                            <i class="fas fa-medal"></i> Ï†êÏàò +1!
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="next-btn" class="btn btn-primary" style="display:none;">
                            Îã§Ïùå Î¨∏Ï†ú <i class="fas fa-arrow-right"></i>
                        </button>
                        <button id="finish-btn" class="btn btn-secondary" onclick="goToLanguageSelect()">
                            Ï¢ÖÎ£åÌïòÍ∏∞
                        </button>
                    </div>
                </div>
                
                <!-- Î°úÎî© ÌëúÏãú -->
                <div id="loading" class="loading-area" style="display:none;">
                    <div class="spinner"></div>
                    <p>Î¨∏Ï†úÎ•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Ìë∏ÌÑ∞ -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2><i class="fas fa-language"></i> LinguaLearn</h2>
                    <p>Ïñ∏Ïñ¥Î•º Î∞∞Ïö∞Îäî ÏÉàÎ°úÏö¥ Î∞©Î≤ï</p>
                </div>
                <div class="footer-links">
                    <div class="link-group">
                        <h3>Í∏∞Îä•</h3>
                        <ul>
                            <li><a href="/quiz/image">Í∑∏Î¶º Îã®Ïñ¥ ÌÄ¥Ï¶à</a></li>
                            <li><a href="/translate">Î¨∏Ïû• Î≤àÏó≠</a></li>
                            <li><a href="/words">ÏùºÏùº Ï∂îÏ≤ú Îã®Ïñ¥</a></li>
                        </ul>
                    </div>
                    <div class="link-group">
                        <h3>ÌöåÏÇ¨</h3>
                        <ul>
                            <li><a href="#">ÏÜåÍ∞ú</a></li>
                            <li><a href="#">Ïó∞ÎùΩÏ≤ò</a></li>
                            <li><a href="#">ÏûêÏ£º Î¨ªÎäî ÏßàÎ¨∏</a></li>
                        </ul>
                    </div>
                    <div class="link-group">
                        <h3>Î≤ïÏ†Å Ï†ïÎ≥¥</h3>
                        <ul>
                            <li><a href="#">Ïù¥Ïö©ÏïΩÍ¥Ä</a></li>
                            <li><a href="#">Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 LinguaLearn. All rights reserved.</p>
                <div class="social-links">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Î°úÍ∑∏Ïù∏ Î™®Îã¨ -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <button class="close-modal"><i class="fas fa-times"></i></button>
            <div class="modal-header">
                <h2>Î°úÍ∑∏Ïù∏ ÎòêÎäî ÌöåÏõêÍ∞ÄÏûÖ</h2>
            </div>
            <div class="modal-body">
                <div id="firebaseui-auth-container"></div>
                <div id="auth-error" style="color: var(--error); margin-top: 15px; text-align: center;"></div>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="modal-overlay"></div>

    <!-- Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
    <script th:src="@{/js/login-modal.js}" defer></script>
    <script th:src="@{/js/firebase-auth-main.js}" defer></script>
    <script th:src="@{/js/image-quiz.js}" defer></script>
</body>
</html>